# 🌙 隔夜选股系统 v6.0 新手使用指南

## 📖 系统简介

隔夜选股系统是一个"T日选股，T+1执行"的短线交易辅助工具。它会在每天收盘后分析市场，生成明日的交易计划，帮助你做好第二天的交易准备。

**核心理念**: 晚上做功课，白天执行计划，避免盘中冲动交易。

---

## 🚀 快速开始 (3分钟上手)

### 第一步：运行选股

打开命令行，进入项目目录，运行：

```bash
python tools/overnight_stock_picker.py
```

系统会自动：
1. 分析大盘环境（强势/震荡/弱势）
2. 判断市场情绪（乐观/中性/恐慌）
3. 对股票池评分
4. 生成明日交易计划

### 第二步：查看交易计划

运行完成后，会在 `data/trading_plans/` 目录生成 Markdown 文件，例如：
```
data/trading_plans/trading_plan_2026-01-07.md
```

打开这个文件，你会看到：
- 📊 市场环境分析
- 📈 推荐买入的股票（最多15只）
- 💰 每只股票的买入价、仓位、止损止盈

### 第三步：第二天执行

第二天早上 9:00-9:15，查看外盘情况：
- 如果 A50 期指跌超 1%，下调买入价 2%
- 如果 A50 期指跌超 2%，只买龙头股

9:25 竞价结束后：
- 如果股票低开超过 4%（核按钮），放弃买入
- 如果龙头股高开爆量，可以追入

---

## 📋 交易计划详解

一份完整的交易计划包含以下内容：

### 1. 市场环境
```
市场环境: 强势
市场情绪: 乐观 (升温)
仓位系数: 1.0x
```
- **强势**: 可以正常操作
- **震荡**: 控制仓位
- **弱势/极弱**: 建议空仓观望

### 2. 推荐股票
每只推荐股票包含：

| 字段 | 说明 | 示例 |
|------|------|------|
| 代码/名称 | 股票基本信息 | 000001 平安银行 |
| 评分 | 明日潜力评分(0-100) | 85分 |
| 理想买入价 | 最佳买入价格 | 9.80 |
| 可接受买入价 | 可以接受的价格 | 10.00 |
| 放弃买入价 | 超过此价不买 | 10.20 |
| 建议仓位 | 占总资金比例 | 20% (14000元) |
| 买入股数 | 具体买多少股 | 1400股 |
| 止损价 | 跌到这里卖出 | 9.31 |
| 第一止盈 | 涨到这里减仓 | 10.50 |
| 第二止盈 | 涨到这里清仓 | 11.00 |

### 3. 操作要点
系统会给出当天的操作建议，例如：
- "今日情绪高潮，明日可能分歧，减半仓位"
- "冰点后修复，可适当试错"

---

## ⏰ 每日操作流程

### 📅 T日（选股日）

| 时间 | 操作 |
|------|------|
| 15:00-15:30 | 收盘后运行选股程序 |
| 15:30-16:00 | 查看交易计划，了解推荐股票 |
| 晚上 | 研究推荐股票的基本面和题材 |

### 📅 T+1日（执行日）

| 时间 | 操作 |
|------|------|
| 08:30-09:00 | 查看美股、A50期指，判断是否需要调整 |
| 09:15-09:25 | 观察竞价情况 |
| 09:25 | 竞价结束，决定是否执行买入 |
| 09:30-09:35 | 按计划挂单买入 |
| 盘中 | 监控持仓，按止损止盈执行 |

---

## 🛡️ 风险控制规则

### 核按钮规则 ⚠️
**低开超过4%，立即放弃买入！**

这是最重要的风险控制规则。如果推荐股票第二天竞价低开超过4%，说明有重大利空，必须放弃。

### 仓位控制
- 单只股票最大仓位: 30%
- 总仓位上限: 80%
- 默认资金: 7万元

### 止损规则
- 默认止损: -5%
- 智能止损: MAX(买入价×0.95, 昨日最低价, 5日均线)

### 移动止盈
- 涨5% → 止盈线提到成本价
- 涨10% → 止盈线提到+5%
- 涨15% → 止盈线提到+10%

---

## 🔧 常用命令

### 基础运行
```bash
# 默认运行（7万资金）
python tools/overnight_stock_picker.py

# 指定资金
python tools/overnight_stock_picker.py --capital 100000

# 指定最低评分
python tools/overnight_stock_picker.py --min-score 75
```

### 🔬 使用科技股池（推荐）
```bash
# 使用100只科技股池
python tools/overnight_stock_picker.py --tech-pool

# 只选特定行业（如半导体和AI）
python tools/overnight_stock_picker.py --tech-pool --sector "半导体,人工智能"

# 刷新科技股数据
python tools/overnight_stock_picker.py --tech-pool --refresh --check-data
```

科技股池包含9大行业100只股票：
- 半导体(13只)、人工智能(11只)、算力(10只)
- 消费电子(15只)、新能源科技(13只)、软件服务(11只)
- 生物医药科技(9只)、5G通信(8只)、智能制造(10只)

### 🔥 热点题材功能
```bash
# 手动指定热点
python tools/overnight_stock_picker.py --topics "AI眼镜,半导体,CES概念"

# 科技股池 + 手动热点
python tools/overnight_stock_picker.py --tech-pool --topics "AI眼镜,半导体"
```

**说明**: 使用 `--topics` 参数手动指定当前市场热点题材，系统会在评分时给相关股票加分。

### 查看帮助
```bash
python tools/overnight_stock_picker.py --help
```

---

## ❓ 常见问题

### Q1: 没有推荐股票怎么办？
**A**: 说明当前市场没有符合条件的股票，建议观望。这是系统在保护你，不要强行交易。

### Q2: 推荐的股票第二天跌了怎么办？
**A**: 严格执行止损。短线交易亏损是正常的，关键是控制单次亏损在5%以内。

### Q3: 可以修改股票池吗？
**A**: 可以。股票池在 `data/processed/` 目录下，系统会自动加载该目录下的所有股票数据。

### Q4: 评分是怎么算的？
**A**: 评分基于6个维度（v6.0版本），总分100分：

| 维度 | 权重 | 说明 |
|------|------|------|
| 题材风口 | 25分 | A股短线第一生产力，评估题材热度和板块效应 |
| 趋势与位置 | 20分 | 评估均线排列和股价相对位置 |
| K线与形态 | 15分 | 识别涨停/反包/突破等K线形态 |
| 量价配合 | 15分 | 分析成交量与价格的配合关系 |
| 资金强度 | 15分 | 评估主力资金流入占比 |
| 股性活跃度 | 10分 | 剔除"死股"，评估股票交易活跃程度 |

**v6.0核心改进**:
- 强调"题材是第一生产力"，题材风口权重提升至25分
- 新增"股性活跃度"维度，自动剔除长期横盘的"死股"
- 资金强度改为相对值（占比），更准确反映资金意图
- 量价配合引入换手率和情境判断
- 趋势与位置结合均线和分位点，识别低位突破和高位风险

### Q5: 什么是"龙头"和"跟风"？
**A**: 
- **真龙头**: 板块最强股，涨停早、封单大、连板多
- **二线龙头**: 次强股，可以参与
- **跟风股**: 跟随龙头上涨，风险较大
- **蹭热点**: 名字相关但业务不相关，建议回避

---

## 📈 v6.0 评分系统详解

### 评分维度说明

#### 1. 题材风口 (25分) - 第一生产力
A股短线交易中，题材是最重要的驱动因素。

| 情况 | 得分 | 说明 |
|------|------|------|
| 主线题材+板块效应强 | 25分 | 龙头股，板块涨停家数≥5 |
| 支线题材+有助攻 | 15分 | 次热点，有板块联动 |
| 独立个股无板块 | 8分 | 有概念但无板块效应 |
| 无题材关联 | 3分 | 无热点概念 |
| 题材退潮期 | 减半 | 评分减半+风险标记 |

#### 2. 趋势与位置 (20分)
评估股价在均线系统中的位置和趋势状态。

| 情况 | 得分 | 说明 |
|------|------|------|
| 低位多头排列 | 20分 | 价格<50%分位，MA5>MA10>MA20>MA60 |
| 突破MA60 | 18分 | 突破60日均线 |
| 突破MA20 | 16分 | 突破20日均线 |
| 均线粘合 | 12-14分 | 三线距离<3%，即将选择方向 |
| 高位加速(乖离率>15%) | 10分 | 标记"追高风险" |
| 空头排列 | 0分 | MA5<MA10<MA20<MA60 |

#### 3. K线与形态 (15分)
识别K线形态判断明日走势方向。

| 形态 | 得分 | 说明 |
|------|------|------|
| 涨停/反包/突破前高 | 15分 | 强势形态 |
| 下影线阳线 | 12分 | 有支撑 |
| 企稳十字星/多方炮 | 10分 | 企稳信号 |
| 普通阳线 | 8分 | 正常上涨 |
| 普通阴线 | 4分 | 正常下跌 |
| 吊颈线/乌云盖顶 | 0分 | 顶部形态，标记风险 |

#### 4. 量价配合 (15分)
分析成交量与价格的配合关系。

| 情况 | 得分 | 说明 |
|------|------|------|
| 缩量涨停 | 15分 | 惜售，强势 |
| 温和放量上涨(1.5-2倍) | 15分 | 健康上涨 |
| 底部/突破口倍量 | 15分 | 启动信号 |
| 正常放量上涨 | 12分 | 正常 |
| 缩量上涨 | 10分 | 抛压减轻 |
| 高位巨量滞涨 | 0分 | 标记"出货风险" |
| 天量阴线 | 0分 | 标记"出货风险" |

**换手率调整**:
- 3%-15%: 正常，不调整
- <1%: 扣2分（流动性差）
- >25%: 扣3分（换手过高）

#### 5. 资金强度 (15分)
评估主力资金流入占成交额的比例。

| 净流入占比 | 得分 | 说明 |
|------------|------|------|
| >10% | 15分 | 主力大幅流入 |
| 5%-10% | 12分 | 主力明显流入 |
| 0%-5% | 8分 | 主力小幅流入 |
| -5%-0% | 5分 | 主力小幅流出 |
| <-10% | 0分 | 主力大幅流出 |

#### 6. 股性活跃度 (10分) - 剔除死股
评估股票的交易活跃程度，避免选到"织布机"走势的股票。

| 情况 | 得分 | 说明 |
|------|------|------|
| 近20日有涨停 | 10分 | 活跃股 |
| 近期有连板 | +2分 | 额外加分 |
| 高波动率(日均振幅>3%) | 8分 | 波动大 |
| 近60日最大涨幅<10% | 2分 | 涨幅有限 |
| 长期横盘 | 0分 | 标记"股性差" |

### 风险标记系统

系统会自动识别并标记以下风险：

| 风险类型 | 触发条件 | 建议 |
|----------|----------|------|
| ⚠️ 追高风险 | 乖离率>15% | 降低仓位或放弃 |
| ⚠️ 出货风险 | 天量阴线/高位巨量滞涨 | 回避 |
| ⚠️ 题材退潮风险 | 题材热度下降 | 谨慎参与 |
| ⚠️ 股性差 | 长期横盘/无涨停 | 回避 |

### 评分解读

| 总分区间 | 评级 | 操作建议 |
|----------|------|----------|
| 80-100分 | 优秀 | 可重仓参与 |
| 70-79分 | 良好 | 正常仓位参与 |
| 60-69分 | 一般 | 轻仓试错 |
| <60分 | 较差 | 建议观望 |

---

## 📊 进阶功能

### 情绪周期预判
系统会分析市场情绪周期：
```
冰点 → 修复 → 升温 → 高潮 → 分歧 → 退潮 → 冰点
```

- **高潮后**: 大概率分歧，减半仓位
- **冰点后**: 大概率修复，可以试错

### 早盘修正
第二天早上，可以运行早盘修正：
```python
from core.overnight_picker import PreMarketAdjuster

adjuster = PreMarketAdjuster()
# 输入A50涨跌幅
overnight_data = adjuster.fetch_overnight_data_with_values(
    a50_change=-0.015,  # A50跌1.5%
    nasdaq_change=-0.01
)
# 调整交易计划
adjusted_plan, report = adjuster.run_pre_market_adjustment(original_plan, overnight_data)
print(report.to_markdown())
```

### 竞价过滤
9:25竞价结束后，检查是否执行买入：
```python
from core.overnight_picker import CallAuctionFilter

filter = CallAuctionFilter()
result = filter.analyze_auction(
    stock_code='000001',
    prev_close=10.0,
    auction_price=9.5,  # 竞价价格
    auction_volume=1000000,
    avg_volume=5000000,
    leader_index=60,
    strategy_type='low_buy'
)
print(result.action)  # BUY / CANCEL / WAIT
print(result.reason)
```

---

## 📞 获取帮助

如果遇到问题：
1. 查看 `docs/` 目录下的其他文档
2. 检查 `logs/` 目录下的日志文件
3. 运行测试确保系统正常：`python -m pytest tests/test_overnight_picker_integration.py -v`

---

**祝你交易顺利！记住：严格执行计划，控制风险第一。** 🎯
