#!/usr/bin/env python3
"""
ç§‘æŠ€è‚¡æ± æ‰©å……è‡³80-100åªå·¥å…· - æœ€ç»ˆç‰ˆ

åŸºäºé¢„ç­›é€‰çš„é«˜è´¨é‡ç§‘æŠ€è‚¡åˆ—è¡¨ï¼Œæ‰©å……è‚¡ç¥¨æ± 
ç›®æ ‡ï¼šå°†è‚¡ç¥¨æ± ä»27åªæ‰©å……è‡³80-100åªé«˜è´¨é‡ä¸»æ¿å’Œä¸­å°æ¿ç§‘æŠ€è‚¡

ä½œè€…: å“è¶Šè‚¡ç¥¨åˆ†æå¸ˆ
ç‰ˆæœ¬: 2.0
æ—¥æœŸ: 2026-01-05
"""

import sys
import os
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from datetime import datetime
from typing import List, Dict, Tuple
from dataclasses import dataclass


@dataclass
class TechStock:
    """ç§‘æŠ€è‚¡æ•°æ®ç»“æ„"""
    code: str
    name: str
    sector: str


# é¢„ç­›é€‰çš„é«˜è´¨é‡ç§‘æŠ€è‚¡åˆ—è¡¨ - åŸºäºè¡Œä¸šåˆ†æå’Œè´¢åŠ¡ç­›é€‰
# æ‰€æœ‰è‚¡ç¥¨å‡ä¸ºä¸»æ¿(600/601/603)å’Œä¸­å°æ¿(000/001/002)è‚¡ç¥¨
PRESCREENED_TECH_STOCKS = {
    "åŠå¯¼ä½“": [
        # ç°æœ‰è‚¡ç¥¨
        {"code": "002371", "name": "åŒ—æ–¹ååˆ›"},
        {"code": "002049", "name": "ç´«å…‰å›½å¾®"},
        {"code": "603501", "name": "éŸ¦å°”è‚¡ä»½"},
        {"code": "002185", "name": "åå¤©ç§‘æŠ€"},
        {"code": "600584", "name": "é•¿ç”µç§‘æŠ€"},
        {"code": "002156", "name": "é€šå¯Œå¾®ç”µ"},
        {"code": "603986", "name": "å…†æ˜“åˆ›æ–°"},
        # æ–°å¢è‚¡ç¥¨
        {"code": "600460", "name": "å£«å…°å¾®"},
        {"code": "002129", "name": "ä¸­ç¯è‚¡ä»½"},
        {"code": "600703", "name": "ä¸‰å®‰å…‰ç”µ"},
        {"code": "002036", "name": "è”åˆ›ç”µå­"},
        {"code": "600353", "name": "æ—­å…‰ç”µå­"},
        {"code": "002077", "name": "å¤§æ¸¯è‚¡ä»½"},
    ],
    "äººå·¥æ™ºèƒ½": [
        # ç°æœ‰è‚¡ç¥¨
        {"code": "002415", "name": "æµ·åº·å¨è§†"},
        {"code": "002230", "name": "ç§‘å¤§è®¯é£"},
        {"code": "002410", "name": "å¹¿è”è¾¾"},
        # æ–°å¢è‚¡ç¥¨
        {"code": "603011", "name": "åˆé”»æ™ºèƒ½"},
        {"code": "001339", "name": "æ™ºå¾®æ™ºèƒ½"},
        {"code": "002421", "name": "è¾¾å®æ™ºèƒ½"},
        {"code": "002849", "name": "å¨æ˜Ÿæ™ºèƒ½"},
        {"code": "002313", "name": "æ—¥æµ·æ™ºèƒ½"},
        {"code": "002362", "name": "æ±‰ç‹ç§‘æŠ€"},
        {"code": "002405", "name": "å››ç»´å›¾æ–°"},
        {"code": "002232", "name": "å¯æ˜ä¿¡æ¯"},
    ],
    "ç®—åŠ›": [
        # ç°æœ‰è‚¡ç¥¨
        {"code": "000977", "name": "æµªæ½®ä¿¡æ¯"},
        {"code": "603019", "name": "ä¸­ç§‘æ›™å…‰"},
        {"code": "002439", "name": "å¯æ˜æ˜Ÿè¾°"},
        {"code": "002916", "name": "æ·±å—ç”µè·¯"},
        {"code": "603703", "name": "ç››æ´‹ç§‘æŠ€"},
        # æ–°å¢è‚¡ç¥¨
        {"code": "000066", "name": "ä¸­å›½é•¿åŸ"},
        {"code": "600756", "name": "æµªæ½®è½¯ä»¶"},
        {"code": "002368", "name": "å¤ªæè‚¡ä»½"},
        {"code": "600845", "name": "å®ä¿¡è½¯ä»¶"},
        {"code": "002065", "name": "ä¸œåè½¯ä»¶"},
    ],
    "æ¶ˆè´¹ç”µå­": [
        # ç°æœ‰è‚¡ç¥¨
        {"code": "002600", "name": "é¢†ç›Šæ™ºé€ "},
        {"code": "002475", "name": "ç«‹è®¯ç²¾å¯†"},
        {"code": "601138", "name": "å·¥ä¸šå¯Œè”"},
        {"code": "002241", "name": "æ­Œå°”è‚¡ä»½"},
        {"code": "002456", "name": "æ¬§è²å…‰"},
        {"code": "002008", "name": "å¤§æ—æ¿€å…‰"},
        {"code": "002273", "name": "æ°´æ™¶å…‰ç”µ"},
        {"code": "002044", "name": "ç¾å¹´å¥åº·"},
        {"code": "002228", "name": "åˆå…´åŒ…è£…"},
        # æ–°å¢è‚¡ç¥¨
        {"code": "002236", "name": "å¤§åè‚¡ä»½"},
        {"code": "002351", "name": "æ¼«æ­¥è€…"},
        {"code": "002055", "name": "å¾—æ¶¦ç”µå­"},
        {"code": "002384", "name": "ä¸œå±±ç²¾å¯†"},
        {"code": "002106", "name": "è±å®é«˜ç§‘"},
        {"code": "002045", "name": "å›½å…‰ç”µå™¨"},
    ],
    "æ–°èƒ½æºç§‘æŠ€": [
        # ç°æœ‰è‚¡ç¥¨
        {"code": "000063", "name": "ä¸­å…´é€šè®¯"},
        {"code": "603169", "name": "å…°çŸ³é‡è£…"},
        {"code": "603528", "name": "å¤šä¼¦ç§‘æŠ€"},
        # æ–°å¢è‚¡ç¥¨
        {"code": "600617", "name": "å›½æ–°èƒ½æº"},
        {"code": "001258", "name": "ç«‹æ–°èƒ½æº"},
        {"code": "000690", "name": "å®æ–°èƒ½æº"},
        {"code": "002202", "name": "é‡‘é£ç§‘æŠ€"},
        {"code": "601012", "name": "éš†åŸºç»¿èƒ½"},
        {"code": "002459", "name": "æ™¶æ¾³ç§‘æŠ€"},
        {"code": "600438", "name": "é€šå¨è‚¡ä»½"},
        {"code": "002129", "name": "TCLä¸­ç¯"},
        {"code": "002074", "name": "å›½è½©é«˜ç§‘"},
        {"code": "002594", "name": "æ¯”äºšè¿ª"},
    ],
    "è½¯ä»¶æœåŠ¡": [
        # æ–°å¢è‚¡ç¥¨
        {"code": "600588", "name": "ç”¨å‹ç½‘ç»œ"},
        {"code": "002279", "name": "ä¹…å…¶è½¯ä»¶"},
        {"code": "002474", "name": "æ¦•åŸºè½¯ä»¶"},
        {"code": "603189", "name": "ç½‘è¾¾è½¯ä»¶"},
        {"code": "600570", "name": "æ’ç”Ÿç”µå­"},
        {"code": "002268", "name": "å«å£«é€š"},
        {"code": "002212", "name": "å¤©èä¿¡"},
        {"code": "002197", "name": "è¯é€šç”µå­"},
        {"code": "600446", "name": "é‡‘è¯è‚¡ä»½"},
        {"code": "002401", "name": "ä¸­è¿œæµ·ç§‘"},
        {"code": "002777", "name": "ä¹…è¿œé“¶æµ·"},
    ],
    "ç”Ÿç‰©åŒ»è¯ç§‘æŠ€": [
        # æ–°å¢è‚¡ç¥¨
        {"code": "002030", "name": "è¾¾å®‰åŸºå› "},
        {"code": "603658", "name": "å®‰å›¾ç”Ÿç‰©"},
        {"code": "002223", "name": "é±¼è·ƒåŒ»ç–—"},
        {"code": "000661", "name": "é•¿æ˜¥é«˜æ–°"},
        {"code": "002007", "name": "åå…°ç”Ÿç‰©"},
        {"code": "000963", "name": "åä¸œåŒ»è¯"},
        {"code": "002252", "name": "ä¸Šæµ·è±å£«"},
        {"code": "002432", "name": "ä¹å®‰åŒ»ç–—"},
        {"code": "002551", "name": "å°šè£åŒ»ç–—"},
    ],
    "5Gé€šä¿¡": [
        # æ–°å¢è‚¡ç¥¨
        {"code": "600498", "name": "çƒ½ç«é€šä¿¡"},
        {"code": "002396", "name": "æ˜Ÿç½‘é”æ·"},
        {"code": "002093", "name": "å›½è„‰ç§‘æŠ€"},
        {"code": "002115", "name": "ä¸‰ç»´é€šä¿¡"},
        {"code": "002446", "name": "ç››è·¯é€šä¿¡"},
        {"code": "002194", "name": "æ­¦æ±‰å‡¡è°·"},
        {"code": "002281", "name": "å…‰è¿…ç§‘æŠ€"},
        {"code": "600522", "name": "ä¸­å¤©ç§‘æŠ€"},
    ],
    "æ™ºèƒ½åˆ¶é€ ": [
        # æ–°å¢è‚¡ç¥¨
        {"code": "002184", "name": "æµ·å¾—æ§åˆ¶"},
        {"code": "002527", "name": "æ–°æ—¶è¾¾"},
        {"code": "002747", "name": "åŸƒæ–¯é¡¿"},
        {"code": "002472", "name": "åŒç¯ä¼ åŠ¨"},
        {"code": "002270", "name": "åæ˜è£…å¤‡"},
        {"code": "002097", "name": "å±±æ²³æ™ºèƒ½"},
        {"code": "002248", "name": "åä¸œæ•°æ§"},
        {"code": "002611", "name": "ä¸œæ–¹ç²¾å·¥"},
    ],
}


def get_all_expanded_stocks() -> List[TechStock]:
    """è·å–æ‰€æœ‰æ‰©å……åçš„è‚¡ç¥¨"""
    stocks = []
    for sector, stock_list in PRESCREENED_TECH_STOCKS.items():
        for stock in stock_list:
            stocks.append(TechStock(
                code=stock["code"],
                name=stock["name"],
                sector=sector
            ))
    return stocks


def count_stocks_by_sector() -> Dict[str, int]:
    """ç»Ÿè®¡å„è¡Œä¸šè‚¡ç¥¨æ•°é‡"""
    counts = {}
    for sector, stock_list in PRESCREENED_TECH_STOCKS.items():
        counts[sector] = len(stock_list)
    return counts


def generate_updated_config() -> str:
    """ç”Ÿæˆæ›´æ–°åçš„é…ç½®æ–‡ä»¶å†…å®¹"""
    lines = [
        '"""',
        'ç§‘æŠ€è‚¡æ± é…ç½®æ¨¡å—',
        '',
        'æä¾›ç§‘æŠ€è‚¡æ± çš„å®Œæ•´é…ç½®å’Œç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š',
        '- å…«ä¸ªç§‘æŠ€è¡Œä¸šçš„è‚¡ç¥¨æ± ï¼ˆåŠå¯¼ä½“ã€AIåº”ç”¨ã€ç®—åŠ›ã€æ¶ˆè´¹ç”µå­ã€æ–°èƒ½æºç§‘æŠ€ã€è½¯ä»¶æœåŠ¡ã€ç”Ÿç‰©åŒ»è¯ç§‘æŠ€ã€5Gé€šä¿¡ã€æ™ºèƒ½åˆ¶é€ ï¼‰',
        '- è‚¡ç¥¨æ± ç®¡ç†åŠŸèƒ½ï¼ˆæ·»åŠ ã€åˆ é™¤ã€ç­›é€‰ï¼‰',
        '- è¡Œä¸šåˆ†ç±»æŸ¥è¯¢',
        '',
        f'æ›´æ–°æ—¶é—´: {datetime.now().strftime("%Y-%m-%d %H:%M:%S")}',
        f'è‚¡ç¥¨æ€»æ•°: {sum(len(v) for v in PRESCREENED_TECH_STOCKS.values())}åª',
        '',
        'Requirements: 12.1, 12.2, 12.3, 12.4',
        '"""',
        '',
        'from typing import Dict, List, Optional, Set',
        'from dataclasses import dataclass',
        '',
        '',
        '# ==========================================',
        '# ç§‘æŠ€è‚¡æ± é…ç½®',
        '# ==========================================',
        '',
        '@dataclass',
        'class StockInfo:',
        '    """è‚¡ç¥¨ä¿¡æ¯"""',
        '    code: str',
        '    name: str',
        '    sector: str',
        '    ',
        '    def to_dict(self) -> Dict[str, str]:',
        '        """è½¬æ¢ä¸ºå­—å…¸"""',
        '        return {',
        '            "code": self.code,',
        '            "name": self.name,',
        '            "sector": self.sector',
        '        }',
        '',
        '',
    ]
    return '\n'.join(lines)


def main():
    """ä¸»å‡½æ•°"""
    print("ğŸš€ ç§‘æŠ€è‚¡æ± æ‰©å……ç³»ç»Ÿ - æœ€ç»ˆç‰ˆ")
    print(f"ğŸ“… è¿è¡Œæ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
    print("=" * 60)
    
    # ç»Ÿè®¡è‚¡ç¥¨æ•°é‡
    sector_counts = count_stocks_by_sector()
    total_count = sum(sector_counts.values())
    
    print(f"\nğŸ“Š æ‰©å……åè‚¡ç¥¨æ± ç»Ÿè®¡:")
    print(f"   æ€»è‚¡ç¥¨æ•°: {total_count} åª")
    print(f"\nğŸ­ è¡Œä¸šåˆ†å¸ƒ:")
    for sector, count in sorted(sector_counts.items(), key=lambda x: x[1], reverse=True):
        pct = count / total_count * 100
        print(f"   {sector}: {count}åª ({pct:.1f}%)")
    
    # æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ç›®æ ‡
    if total_count >= 80:
        print(f"\nâœ… æ‰©å……æˆåŠŸ! è‚¡ç¥¨æ± è§„æ¨¡: {total_count}åª (ç›®æ ‡: 80-100åª)")
    else:
        print(f"\nâš ï¸ å½“å‰: {total_count}åªï¼Œéœ€è¦ç»§ç»­æ‰©å……")
    
    # æ˜¾ç¤ºæ‰€æœ‰è‚¡ç¥¨
    print(f"\nğŸ“‹ å®Œæ•´è‚¡ç¥¨æ¸…å•:")
    print("-" * 60)
    
    all_stocks = get_all_expanded_stocks()
    for sector in PRESCREENED_TECH_STOCKS.keys():
        sector_stocks = [s for s in all_stocks if s.sector == sector]
        print(f"\nã€{sector}ã€‘({len(sector_stocks)}åª)")
        for stock in sector_stocks:
            print(f"   {stock.code} {stock.name}")
    
    return total_count


if __name__ == "__main__":
    main()
