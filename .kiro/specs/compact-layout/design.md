# 每日信号页面紧凑布局设计

## 设计目标

优化每日信号页面的信息展示，使关键信息更加集中，减少用户的滚动操作，提升用户体验。

## 架构设计

### 页面布局结构

```
┌─────────────────────────────────────────────────────────────┐
│ 标题：📡 每日交易信号                                        │
├─────────────────────────────────────────────────────────────┤
│ 数据新鲜度警告（如有）                                       │
│ 休市安民告示（如有）                                         │
│ 早安确认清单                                                 │
├─────────────────────────────────────────────────────────────┤
│ 左列 (50%)              │ 右列 (50%)                         │
│ ┌─────────────────────┐ │ ┌─────────────────────┐          │
│ │ 🚨 持仓卖出信号      │ │ │ 📋 策略配置          │          │
│ │ - 持仓数量          │ │ │ - 策略选择           │          │
│ │ - 止损信号数        │ │ │ - 策略描述           │          │
│ │ - 详情（expander）  │ │ │ - 参数（expander）   │          │
│ └─────────────────────┘ │ └─────────────────────┘          │
│ ┌─────────────────────┐ │ ┌─────────────────────┐          │
│ │ 📊 大盘状态          │ │ │ 🔔 飞书通知          │          │
│ │ - 沪深300指数       │ │ │ - 启用状态           │          │
│ │ - MA均线对比        │ │ │ - 配置（expander）   │          │
│ └─────────────────────┘ │ └─────────────────────┘          │
├─────────────────────────────────────────────────────────────┤
│ ⚙️ 信号生成                                                  │
│ - 股票池选择                                                 │
│ - 生成按钮                                                   │
├─────────────────────────────────────────────────────────────┤
│ 📋 信号汇总表                                                │
├─────────────────────────────────────────────────────────────┤
│ 📜 历史信号                                                  │
└─────────────────────────────────────────────────────────────┘
```

## 组件设计

### 1. render_sell_signals_section_compact()

**输入**：无（从 PositionTracker 获取持仓数据）

**输出**：渲染紧凑版持仓卖出信号

**实现逻辑**：
```python
1. 获取所有持仓
2. 如果无持仓，显示"当前无持仓"
3. 检查卖出信号
4. 如果无信号，显示"✅ X 只持仓无卖出信号"
5. 如果有信号：
   - 使用 metrics 显示持仓数量和止损信号数
   - 使用 expander 显示信号详情
   - 紧急止损信号自动展开
```

**UI 组件**：
- `st.markdown()` - 标题
- `st.metric()` - 持仓数量、止损信号数
- `st.expander()` - 信号详情
- `st.error()` / `st.warning()` - 信号提示

### 2. render_market_status_compact()

**输入**：无（从 Screener 获取大盘数据）

**输出**：渲染紧凑版大盘状态

**实现逻辑**：
```python
1. 获取大盘状态
2. 根据状态显示不同颜色的提示
3. 使用 metric 显示沪深300指数和MA均线
```

**UI 组件**：
- `st.markdown()` - 标题
- `st.success()` / `st.error()` - 状态提示
- `st.metric()` - 指数和均线

### 3. render_notification_settings_compact()

**输入**：无（从 NotificationConfigStore 加载配置）

**输出**：渲染紧凑版飞书通知设置

**实现逻辑**：
```python
1. 加载已保存配置
2. 显示当前状态（已启用/未配置）
3. 显示脱敏后的 Webhook URL
4. 配置面板放在 expander 中
5. 保存和测试按钮并排显示
```

**UI 组件**：
- `st.markdown()` - 标题
- `st.success()` / `st.info()` - 状态提示
- `st.caption()` - 配置信息
- `st.expander()` - 配置面板
- `st.text_input()` - Webhook URL 输入
- `st.checkbox()` - 启用开关
- `st.button()` - 保存和测试按钮

### 4. main() 函数布局调整

**修改点**：
```python
# 原布局：垂直排列
render_sell_signals_section()
render_market_status()
render_notification_settings()

# 新布局：两列布局
col_sell, col_market = st.columns(2)
with col_sell:
    render_sell_signals_section_compact()
with col_market:
    render_market_status_compact()

col_strategy, col_notification = st.columns([2, 1])
with col_strategy:
    # 策略选择和参数显示
with col_notification:
    render_notification_settings_compact()
```

## 数据流

```
用户打开页面
    ↓
加载持仓数据 → render_sell_signals_section_compact()
    ↓
加载大盘数据 → render_market_status_compact()
    ↓
加载通知配置 → render_notification_settings_compact()
    ↓
用户选择策略和股票池
    ↓
点击"生成今日信号"
    ↓
生成信号 → 显示信号汇总表
```

## 技术实现

### Streamlit 组件使用

- `st.columns()` - 创建多列布局
- `st.metric()` - 显示关键指标
- `st.expander()` - 可展开/折叠的内容区域
- `st.success()` / `st.error()` / `st.warning()` - 状态提示
- `st.caption()` - 辅助说明文字

### 响应式设计

- 使用 Streamlit 的自适应列宽
- 在较小屏幕上，列会自动堆叠
- 使用 `use_container_width=True` 确保按钮自适应宽度

## 性能优化

- 减少不必要的数据查询
- 使用缓存机制（如果需要）
- 避免重复渲染

## 兼容性

- 保持原有函数不变，新增紧凑版函数
- 用户可以通过修改 main() 函数切换布局
- 向后兼容，不影响现有功能

## 测试计划

1. **功能测试**
   - 验证所有组件正常显示
   - 验证 expander 可正常展开/折叠
   - 验证按钮功能正常

2. **布局测试**
   - 在不同屏幕分辨率下测试
   - 验证列宽比例合理
   - 验证无横向滚动

3. **性能测试**
   - 测试页面加载时间
   - 测试布局切换延迟

## 未来优化

- 支持用户自定义布局
- 添加更多可配置选项
- 优化移动端显示
