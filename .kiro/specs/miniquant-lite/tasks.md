# Implementation Plan: MiniQuant-Lite

## Overview

æœ¬å®ç°è®¡åˆ’å°† MiniQuant-Lite é‡åŒ–æŠ•èµ„è¾…åŠ©ç³»ç»Ÿåˆ†è§£ä¸ºå¯æ‰§è¡Œçš„ç¼–ç ä»»åŠ¡ã€‚é‡‡ç”¨å¢é‡å¼€å‘æ–¹å¼ï¼Œæ¯ä¸ªä»»åŠ¡æ„å»ºåœ¨å‰ä¸€ä¸ªä»»åŠ¡çš„åŸºç¡€ä¸Šï¼Œç¡®ä¿ä»£ç å§‹ç»ˆå¯è¿è¡Œã€‚

æŠ€æœ¯æ ˆï¼šPython 3.10+, AkShare, Pandas, Backtrader, Streamlit, pytest, hypothesis

## Tasks

- [x] 1. é¡¹ç›®åˆå§‹åŒ–ä¸åŸºç¡€æ¶æ„
  - [x] 1.1 åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„å’Œé…ç½®æ–‡ä»¶
    - åˆ›å»º `core/`, `strategies/`, `backtest/`, `app/`, `config/`, `tests/` ç›®å½•
    - åˆ›å»º `requirements.txt` å¹¶é”å®š AkShare ç‰ˆæœ¬ (1.12.0)
    - åˆ›å»º `config/settings.py` å…¨å±€é…ç½®ç±»
    - _Requirements: 1.7, 8.1, 8.5_
  - [x] 1.2 åˆ›å»º `config/stock_pool.py` è‚¡ç¥¨æ± é…ç½®
    - å®šä¹‰è‡ªé€‰è‚¡åˆ—è¡¨å’Œæ²ªæ·±300æˆåˆ†è‚¡è·å–å‡½æ•°
    - _Requirements: 8.3_

- [x] 2. Data Feed æ¨¡å—å®ç°
  - [x] 2.1 å®ç° `core/data_feed.py` åŸºç¡€åŠŸèƒ½
    - å®ç° `DataFeed` ç±»åˆå§‹åŒ–å’Œ AkShare ç‰ˆæœ¬æ£€æŸ¥
    - å®ç° `download_stock_data()` å•åªè‚¡ç¥¨ä¸‹è½½ï¼ˆå‰å¤æƒï¼‰
    - å®ç°è¯¦ç»†çš„é”™è¯¯è¯Šæ–­ï¼ˆåŒºåˆ†ç½‘ç»œé—®é¢˜å’Œæ¥å£å˜æ›´ï¼‰
    - _Requirements: 1.1, 1.3, 1.4_
  - [x] 2.2 å®ç°æ‰¹é‡ä¸‹è½½å’Œæ•°æ®æ¸…æ´—
    - å®ç° `download_batch()` ä¸²è¡Œæ‰¹é‡ä¸‹è½½ï¼ˆ0.5ç§’é—´éš”ï¼‰
    - å®ç° `clean_data()` è½¬æ¢ä¸º Backtrader æ ¼å¼
    - å®ç° `overwrite_update()` è¦†ç›–æ›´æ–°ç­–ç•¥
    - _Requirements: 1.2, 1.5, 1.6_
  - [x] 2.3 å®ç° `get_market_snapshot()` å…¨å¸‚åœºå¿«ç…§é¢„å‰ªæ
    - è°ƒç”¨ `ak.stock_zh_a_spot_em()` è·å–å®æ—¶å¿«ç…§
    - å®ç°å¸‚å€¼ã€æ¢æ‰‹ç‡ã€ST é¢„å‰ªæè¿‡æ»¤
    - _Requirements: 1.8, 2.13_
  - [ ]* 2.4 ç¼–å†™ Data Feed å±æ€§æµ‹è¯•
    - **Property 1: æ•°æ®æ¸…æ´—æ ¼å¼æ­£ç¡®æ€§**
    - **Property 7: è¦†ç›–æ›´æ–°æ•°æ®æ­£ç¡®æ€§**
    - **Property 21: é¢„å‰ªæç»“æœæ­£ç¡®æ€§**
    - **Validates: Requirements 1.2, 1.3, 1.6, 1.8**

- [x] 3. Checkpoint - æ•°æ®å±‚éªŒè¯
  - ç¡®ä¿æ‰€æœ‰æ•°æ®å±‚æµ‹è¯•é€šè¿‡ï¼ŒéªŒè¯ AkShare æ¥å£å¯ç”¨æ€§

- [x] 4. Screener æ¨¡å—å®ç°
  - [x] 4.1 å®ç° `core/screener.py` åŸºç¡€ç­›é€‰åŠŸèƒ½
    - å®šä¹‰ `ScreenerCondition`, `LiquidityFilter`, `MarketFilter`, `IndustryDiversification` æ•°æ®ç±»
    - å®ç° `Screener` ç±»åˆå§‹åŒ–å’Œæ¡ä»¶ç®¡ç†
    - å®ç° `calculate_indicators()` æŠ€æœ¯æŒ‡æ ‡è®¡ç®—ï¼ˆMA, MACD, RSIï¼‰
    - _Requirements: 2.1, 2.2, 2.3_
  - [x] 4.2 å®ç°æµåŠ¨æ€§è¿‡æ»¤å’Œå¤§ç›˜æ»¤ç½‘
    - å®ç° `_check_market_condition()` æ²ªæ·±300 MA20 æ»¤ç½‘
    - å®ç° `_check_st_stock()`, `_check_listing_days()`, `_check_ma60_trend()`
    - _Requirements: 2.6, 2.7, 2.8, 2.9, 2.10, 2.11_
  - [x] 4.3 å®ç°ä¸¤é˜¶æ®µç­›é€‰ `screen()` æ–¹æ³•
    - ç¬¬ä¸€é˜¶æ®µï¼šè°ƒç”¨ `get_market_snapshot()` é¢„å‰ªæ
    - ç¬¬äºŒé˜¶æ®µï¼šå¯¹å€™é€‰æ± ä¸‹è½½å†å²æ•°æ®å¹¶ç²¾ç­›
    - å®ç° `_apply_industry_diversification()` è¡Œä¸šäº’æ–¥
    - _Requirements: 2.4, 2.5, 2.12, 2.13_
  - [ ]* 4.4 ç¼–å†™ Screener å±æ€§æµ‹è¯•
    - **Property 2: ç­›é€‰ç»“æœæ»¡è¶³æ¡ä»¶**
    - **Property 12: æµåŠ¨æ€§è¿‡æ»¤æ­£ç¡®æ€§**
    - **Property 13: MA60 è¶‹åŠ¿è¿‡æ»¤æ­£ç¡®æ€§**
    - **Property 17: å¤§ç›˜æ»¤ç½‘æ­£ç¡®æ€§**
    - **Property 18: è¡Œä¸šäº’æ–¥æ­£ç¡®æ€§**
    - **Property 22: ä¸¤é˜¶æ®µç­›é€‰ä¸€è‡´æ€§**
    - **Validates: Requirements 2.1-2.13**

- [x] 5. Checkpoint - ç­›é€‰å±‚éªŒè¯
  - ç¡®ä¿æ‰€æœ‰ç­›é€‰å±‚æµ‹è¯•é€šè¿‡ï¼ŒéªŒè¯é¢„å‰ªææ€§èƒ½æå‡

- [x] 6. Sizer æ¨¡å—å®ç°
  - [x] 6.1 å®ç° `core/sizers.py` æ™ºèƒ½ä»“ä½ç®¡ç†
    - å®ç° `SmallCapitalSizer` ç±»ï¼ˆBacktrader Sizerï¼‰
    - å®ç° `calculate_max_shares()` å‡½æ•°ï¼ˆå«æ‹’ç»åŸå› é€ä¼ ï¼‰
    - å®ç° `calculate_actual_fee_rate()` å®é™…è´¹ç‡è®¡ç®—
    - å®ç° 5% ç°é‡‘ç¼“å†²ã€æœ€å°äº¤æ˜“é—¨æ§›ã€é«˜è´¹ç‡é¢„è­¦
    - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8, 4.9_
  - [ ]* 6.2 ç¼–å†™ Sizer å±æ€§æµ‹è¯•
    - **Property 3: ä»“ä½è®¡ç®—æ­£ç¡®æ€§**
    - **Property 19: ç°é‡‘ç¼“å†²æ­£ç¡®æ€§**
    - **Validates: Requirements 4.1-4.9**

- [x] 7. Strategy æ¨¡å—å®ç°
  - [x] 7.1 å®ç° `strategies/base_strategy.py` ç­–ç•¥åŸºç±»
    - å®ç° `BaseStrategy` ç±»ï¼ˆæ—¥å¿—ã€è®¢å•é€šçŸ¥ã€æŒä»“æ‰“å°ï¼‰
    - _Requirements: 5.1, 5.5_
  - [x] 7.2 å®ç° `strategies/trend_filtered_macd_strategy.py` è¶‹åŠ¿ç­–ç•¥
    - å®ç° `TrendFilteredMACDStrategy` ç±»
    - å®ç° `_check_buy_conditions()` ä¹°å…¥æ¡ä»¶ï¼ˆMA60 + MACD + RSI<80ï¼‰
    - å®ç° `_check_exit_conditions()` é€€å‡ºæ¡ä»¶ï¼ˆç¡¬æ­¢æŸ-8% + ç§»åŠ¨æ­¢ç›ˆ15%/5% + MACDæ­»å‰ï¼‰
    - å®ç° `PositionTracker` æŒä»“è·Ÿè¸ªå™¨
    - _Requirements: 5.2, 5.3, 5.4, 5.6, 5.7, 5.8, 5.9, 5.10_
  - [ ]* 7.3 ç¼–å†™ Strategy å±æ€§æµ‹è¯•
    - **Property 9: è¶‹åŠ¿æ»¤ç½‘ä¹°å…¥æ¡ä»¶æ­£ç¡®æ€§**
    - **Property 10: ç¡¬æ­¢æŸè§¦å‘æ­£ç¡®æ€§**
    - **Property 11: ç§»åŠ¨æ­¢ç›ˆè§¦å‘æ­£ç¡®æ€§**
    - **Validates: Requirements 5.6-5.10**

- [x] 8. Checkpoint - ç­–ç•¥å±‚éªŒè¯
  - ç¡®ä¿æ‰€æœ‰ç­–ç•¥å±‚æµ‹è¯•é€šè¿‡

- [x] 9. Backtest Engine å®ç°
  - [x] 9.1 å®ç° `backtest/run_backtest.py` å›æµ‹å¼•æ“
    - å®ç° `BacktestConfig`, `BacktestResult` æ•°æ®ç±»
    - å®ç° `BacktestEngine` ç±»ï¼ˆCerebro å°è£…ï¼‰
    - å®ç° `_is_limit_up_down()` æ¶¨è·Œåœæ¿æ£€æµ‹
    - å®ç° `load_benchmark()` åŠ è½½æ²ªæ·±300åŸºå‡†
    - _Requirements: 3.1, 3.2, 3.4, 3.7_
  - [x] 9.2 å®ç°å›æµ‹æŒ‡æ ‡è®¡ç®—
    - å®ç° `_calculate_metrics()` ç»©æ•ˆæŒ‡æ ‡è®¡ç®—
    - è®¡ç®—æ€»æ”¶ç›Šç‡ã€å¹´åŒ–æ”¶ç›Šç‡ã€æœ€å¤§å›æ’¤ã€å¤æ™®æ¯”ç‡ã€èƒœç‡ã€Alpha
    - ç”Ÿæˆèµ„é‡‘æ›²çº¿å’Œäº¤æ˜“æ˜ç»†ï¼ˆå«æ­¢æŸ/æ­¢ç›ˆåŸå› ï¼‰
    - _Requirements: 3.3, 3.5, 3.6, 3.8, 3.9_
  - [ ]* 9.3 ç¼–å†™ Backtest å±æ€§æµ‹è¯•
    - **Property 4: å›æµ‹ç»“æœå®Œæ•´æ€§**
    - **Property 8: æ¶¨è·Œåœæ¿æ£€æµ‹æ­£ç¡®æ€§**
    - **Validates: Requirements 3.3-3.7**

- [x] 10. è´¢æŠ¥çª—å£æœŸæ£€æµ‹å®ç°
  - [x] 10.1 å®ç° `core/report_checker.py` è´¢æŠ¥æ£€æµ‹å™¨
    - å®ç° `ReportChecker` ç±»
    - å®ç° `check_report_window()` æ£€æŸ¥è´¢æŠ¥æŠ«éœ²çª—å£æœŸï¼ˆÂ±3å¤©ï¼‰
    - _Requirements: 10.1, 10.2_
  - [ ]* 10.2 ç¼–å†™è´¢æŠ¥æ£€æµ‹å±æ€§æµ‹è¯•
    - **Property 14: è´¢æŠ¥çª—å£æœŸæ£€æµ‹æ­£ç¡®æ€§**
    - **Validates: Requirements 10.1, 10.2**

- [-] 11. Signal Generator å®ç°
  - [x] 11.1 å®ç° `core/signal_generator.py` ä¿¡å·ç”Ÿæˆå™¨
    - å®ç° `TradingSignal` æ•°æ®ç±»ï¼ˆå« news_url, in_report_windowï¼‰
    - å®ç° `SignalGenerator` ç±»
    - å®ç° `_calculate_limit_cap()` é™ä»·ä¸Šé™è®¡ç®—ï¼ˆæ”¶ç›˜ä»·Ã—1.01ï¼‰
    - å®ç° `_generate_news_url()` ä¸œæ–¹è´¢å¯Œæ–°é—»é“¾æ¥ç”Ÿæˆ
    - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6_
  - [ ]* 11.2 ç¼–å†™ Signal å±æ€§æµ‹è¯•
    - **Property 5: ä¿¡å·æ ¼å¼å®Œæ•´æ€§**
    - **Property 15: é™ä»·ä¸Šé™è®¡ç®—æ­£ç¡®æ€§**
    - **Property 20: æ–°é—»é“¾æ¥ç”Ÿæˆæ­£ç¡®æ€§**
    - **Validates: Requirements 6.2, 6.3, 12.1, 12.2**

- [x] 12. Checkpoint - æ ¸å¿ƒé€»è¾‘éªŒè¯
  - ç¡®ä¿æ‰€æœ‰æ ¸å¿ƒé€»è¾‘æµ‹è¯•é€šè¿‡ï¼Œask the user if questions arise

- [x] 13. Streamlit Dashboard å®ç°
  - [x] 13.1 å®ç° `app/Home.py` é¦–é¡µ
    - å®ç°ç³»ç»Ÿæ¦‚è§ˆï¼ˆåˆå§‹èµ„é‡‘ã€è‚¡ç¥¨æ± æ•°é‡ã€ä»Šæ—¥ä¿¡å·ï¼‰
    - å®ç°"é¿é™©æˆ˜ç»©çœ‹æ¿"ï¼ˆå¤§ç›˜æ»¤ç½‘ç”Ÿæ•ˆæœŸé—´è§„é¿çš„ä¸‹è·Œé£é™©ï¼‰
    - _Requirements: 7.1, 7.9_
  - [x] 13.2 å®ç° `app/pages/1_ğŸ“Š_Data_Manager.py` æ•°æ®ç®¡ç†é¡µé¢
    - å®ç°æ•°æ®çŠ¶æ€æ¦‚è§ˆå’Œä¸‹è½½åŠŸèƒ½
    - å®ç°"ä¸€é”®æ¸…ç©ºç¼“å­˜"æŒ‰é’®
    - _Requirements: 7.2, 7.3_
  - [x] 13.3 å®ç° `app/pages/2_ğŸ§ª_Backtest.py` å›æµ‹é¡µé¢
    - å®ç°ç­–ç•¥é€‰æ‹©å’Œå‚æ•°é…ç½®
    - å®ç°å›æµ‹ç»“æœå±•ç¤ºï¼ˆæ ¸å¿ƒé£æ§æŒ‡æ ‡çªå‡ºæ˜¾ç¤ºï¼‰
    - å®ç°ç­–ç•¥å‡€å€¼ vs æ²ªæ·±300åŸºå‡†å¯¹æ¯”å›¾
    - å®ç°"å›æµ‹å±€é™æ€§å…è´£å£°æ˜"
    - _Requirements: 7.4, 7.5, 7.8, 11.1, 11.2, 11.3, 11.4_
  - [x] 13.4 å®ç° `app/pages/3_ğŸ“¡_Daily_Signal.py` ä¿¡å·é¡µé¢
    - å®ç°"æ—©å®‰ç¡®è®¤æ¸…å•"ï¼ˆPre-market Checklistï¼‰
    - å®ç°ä¿¡å·è¡¨æ ¼ï¼ˆå«æ–°é—»é“¾æ¥ã€è´¢æŠ¥çª—å£æœŸè­¦å‘Šï¼‰
    - å®ç°é«˜è´¹ç‡é¢„è­¦çº¢è‰²é«˜äº®
    - _Requirements: 7.6, 7.7, 7.10, 12.1, 12.2, 12.3_

- [x] 14. æ—¥å¿—ç³»ç»Ÿå®ç°
  - [x] 14.1 å®ç°æ—¥å¿—é…ç½®
    - é…ç½® Python logging æ¨¡å—
    - å®ç°æŒ‰æ—¥æœŸåˆ†æ–‡ä»¶å­˜å‚¨
    - å®ç°æ—¥å¿—çº§åˆ«é…ç½®
    - _Requirements: 9.1, 9.2, 9.3, 9.4, 9.5_

- [x] 15. Final Checkpoint - é›†æˆæµ‹è¯•
  - ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
  - éªŒè¯ç«¯åˆ°ç«¯æµç¨‹ï¼šæ•°æ®ä¸‹è½½ â†’ ç­›é€‰ â†’ å›æµ‹ â†’ ä¿¡å·ç”Ÿæˆ â†’ UI å±•ç¤º
  - ask the user if questions arise

## Notes

- ä»»åŠ¡æ ‡è®° `*` ä¸ºå¯é€‰æµ‹è¯•ä»»åŠ¡ï¼Œå¯è·³è¿‡ä»¥åŠ å¿« MVP å¼€å‘
- æ¯ä¸ªå±æ€§æµ‹è¯•å¼•ç”¨è®¾è®¡æ–‡æ¡£ä¸­çš„ Property ç¼–å·
- Checkpoint ä»»åŠ¡ç”¨äºé˜¶æ®µæ€§éªŒè¯ï¼Œç¡®ä¿å¢é‡å¼€å‘çš„ç¨³å®šæ€§
- å±æ€§æµ‹è¯•ä½¿ç”¨ hypothesis åº“ï¼Œæ¯ä¸ªæµ‹è¯•è‡³å°‘è¿è¡Œ 100 æ¬¡è¿­ä»£
